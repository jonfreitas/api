"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.healthCheck = void 0;
const core_1 = require("@sdk12/core");
const healthCheck = (options) => {
    const upTime = (0, core_1.uptimeFormatted)();
    options = options || {};
    options.test = options.test || (() => { });
    if (typeof options.test !== 'function') {
        throw new Error('O método `test` do healthcheck deve ser uma função');
    }
    options.healthy = options.healthy || (() => ({ uptime: upTime }));
    if (typeof options.healthy !== 'function') {
        throw new Error('O método `healthy` do healthcheck deve ser uma função');
    }
    if (options.test.length === 0) {
        const test = options.test;
        options.test = (callback) => {
            callback(test());
        };
    }
    return (req, res) => {
        try {
            options.test((err) => {
                let status = 200, response = options.healthy();
                if (err) {
                    status = 500;
                    response = err;
                }
                res.status(status).json(response);
            });
        }
        catch (e) {
            res.status(500).json(e);
        }
    };
};
exports.healthCheck = healthCheck;
//# sourceMappingURL=healthcheck.js.map